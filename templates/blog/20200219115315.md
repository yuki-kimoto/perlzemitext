<h2>Perlで始めるCSVのテキスト処理</h2>

# イントロダクション

**「大量データの処理をすると、エクセルが重くて開けない。。」**

昔、CSVファイルを上司から渡されて、エクセルで処理しようとした時の自分の感想です。そのときは、CSVファイルを３つくらいに分割して処理させました。

しかし、かなり後になって、Perlを使うと、重くて処理できない大容量のファイルでもパソコンをフリーズさせることなく処理できることが分かりました。

このトピックでは、仕事でパソコンを使っているけどプログラミングに詳しくない人を対象に、文書データを便利に処理するための方法を紹介します。

# サイズの大きいファイルでもフリーズしないやり方

過去の事務作業で上司から渡されたのは、経理データでした。
**今年は法令監査に対応しないといけないので、過去１０年分のデータを集計しないといけなかった**のです。

データは、CSV 形式でした。CSV というのは、データとデータがカンマ（,）で区切られたものです。

## Perl を使ってデータを読み込もう

エクセルで読み込むとパソコンがフリーズするので、どうにかしたいですよね。

そこで、Perl を使ってみましょう。大きなデータも読み込めるし、エクセルと比べてサクサク処理が出来ます。

今回は、まず CSV ファイルを読み込んでみます。

### 読み込むデータ(data.csv)

<pre>
year,month,sales,profit
2019,1,1000,800
2019,2,2000,900
2019,3,3000,1000
</pre>

### データを読み込むプログラム(csv_read.pl)

<pre>
#! /usr/bin/env perl
use strict;
use warnings;

while (my $line = <>) {
  print $line;
}
</pre>

### プログラムの実行

以下のようにコマンドを打ち込みます。**ドルマーク（＄）は、コマンドラインであることを示す記号なので、実際には打ち込まないでください。**

<pre>
$ perl csv_read.pl data.csv
</pre>

### 実行結果

<pre>
year,month,sales,profit
2019,1,1000,800
2019,2,2000,900
2019,3,3000,1000$
</pre>

少し不格好ですが、data.csv のデータがすべて出力されましたね。**一歩前進です！**

次は、この不格好な出力を何とかしてみましょう。

# 出力を見やすくしよう

CSVのデータがすべて出力されたのは良いのですが、不格好ですね。

まず、`2019,3,3000,1000$`という表示になっていますので、ドルマーク（＄）を同じ行に表示させないようにしましょう。

プログラムを次のように書き換えます。

### 書き換えたプログラム(csv\_read\_new.pl)

<pre>
#! /usr/bin/env perl
use strict;
use warnings;

while (my $line = <>) {
+  chomp $line;
  print $line;
+  print "\n";
}
</pre>

<br>

左側にプラス記号（+）を付けた行が、追加した行です。**プラス記号は目印なので、実際のプログラムには書かないでください。**

実行してみると、ドルマークが改行されて表示されます。

<pre>
year,month,sales,profit
2019,1,1000,800
2019,2,2000,900
2019,3,3000,1000
$
</pre>

これで見栄えが良くなりました！

### プログラムに興味のある方への補足

`chomp $line;`というのが、改行を除去するための文です。

このプログラムは、CSVファイルを１行ずつ読み込みますが、行には改行の情報も存在しています（正確には、改行コードというデータが行末に存在しています）。

改行の情報はプログラムで処理するには余計なことが多いので、`chomp $line`で取り除きます。

`print "\n";`は、改行情報を表示するための文です。見栄えを整えるために、取り除いた改行の情報をプログラムで出力しています。

このように、**改行の情報はプログラムで追加したほうが分かりやすくなります**。
